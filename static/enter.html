<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Enter Medical Info</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fef3e2;
      padding: 30px;
      max-width: 600px;
      margin: auto;
    }


    h2 {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-weight: bold;
      margin-top: 20px;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-top: 5px;
      box-sizing: border-box;
    }

    button {
      margin-top: 30px;
      padding: 12px 24px;
      font-size: 16px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background-color: #555;
    }

    .back-button {
      display: inline-block;
      font-size: 20px;
      font-weight: bold;
      background-color: white;
      color: #333;
      border-radius: 50%;
      padding: 6px 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      margin-bottom: 20px;
    }
  </style>
  <script src="lang.js"></script>
</head>
<body>
  <div class="back-button" onclick="window.location.href='main.html'">ğŸ </div>
  <div class="back-button" onclick="history.back()">â†</div>
  
  <h2>Enter Medical Info</h2>

  <label for="date">Date</label>
  <input type="date" id="date" required />

  <label for="thisname">Title</label>
  <textarea id="thisname" required></textarea>
  
  <label for="q1">Any significant medical history?</label>
  <textarea id="q1"></textarea>

  <label for="q2">Your current symptoms or discomfort</label>
  <textarea id="q2"></textarea>

  <label for="q3">Lifestyle habits</label>
  <textarea id="q3"></textarea>

  <label for="q4">Are you currently taking any medications?</label>
  <textarea id="q4"></textarea>

  <label for="q5">Doctor diagnosed condition</label>
  <textarea id="q5" required></textarea>

  <label for="q6">Specific concerns</label>
  <textarea id="q6"></textarea>

  <label for="q7">Age</label>
  <input type="number" id="q7" />


  <button id="submitbtn" onclick="submitRecord()">Submit</button>

<script>
  async function submitRecord() {
    const requiredFields=[
        "date", "q7", "thisname"
    ];

    for (const id of requiredFields){
      const value = document.getElementById(id).value.trim();
      if(!value){
        let alertMsg = "âš ï¸ Please complete all required fields!";
        if (currentLang === "zh-TW") {
            alertMsg = "âš ï¸ è«‹å®Œæ•´å¡«å¯«æ‰€æœ‰æ¬„ä½ï¼";
        }
        alert(alertMsg);
        return;
      }
    }
    const record = {
      date: document.getElementById("date").value,
      q1: document.getElementById("q1").value,
      q2: document.getElementById("q2").value,
      q3: document.getElementById("q3").value,
      q4: document.getElementById("q4").value,
      q5: document.getElementById("q5").value,
      q6: document.getElementById("q6").value,
      q7: document.getElementById("q7").value,
      thisname: document.getElementById("thisname").value,
      summary: ""
    };
    const allRecords = JSON.parse(localStorage.getItem("medicalRecords") || "[]");
    
    if (allRecords.length >= 20) {
      let alertMessage = `âš ï¸To add more, please keep your records under 20.`;
      if (currentLang === "zh-TW"){
        alertMessage ="âš ï¸ å·²é”æœ€å¤š 20 ç­†ç´€éŒ„ä¸Šé™ï¼Œè«‹å…ˆåˆªé™¤ä¸€äº›ç´€éŒ„å†æ–°å¢ã€‚";
      }
      alert(alertMessage);
      return;
    }
    const alreadyExists = allRecords.some(r => r.date === record.date);
    if (alreadyExists) {
      let alertMessage =`âš ï¸ï¸A record with the date ${record.date} already exists.Please change the date or delete the original before submitting again.`;
      if(currentLang === "zh-TW") {
        alert(`âš ï¸ ${record.date} å·²ç¶“æœ‰ä¸€ç­†åŒæ¨£æ—¥æœŸçš„ç´€éŒ„å›‰ï¼Œè«‹ä¿®æ”¹æ—¥æœŸæˆ–åˆªé™¤åŸç´€éŒ„å¾Œé‡æ–°é€å‡ºã€‚`);
      }
    return; 
    }
    try {
      const res = await fetch("http://localhost:8000/submit_entry", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(record)
      });

      const result = await res.json();
      console.log("âœ… å¾Œç«¯å›æ‡‰ï¼š", result);

      // å­˜å…¥ localStorage
      const allRecords = JSON.parse(localStorage.getItem("medicalRecords") || "[]");
      allRecords.push(record);
      localStorage.setItem("medicalRecords", JSON.stringify(allRecords));
      alert("Record saved!");
      // å°å‘ä¸‹ä¸€é 
      window.location.href = "medical.html";

    } catch (err) {
      alert("âŒ ç™¼é€éŒ¯èª¤ï¼š" + err.message);
    }
  }
  function updateenterLangUI(){
      if (currentLang === 'zh-TW') {
        document.querySelector('title').textContent = 'å¡«å¯«ç—…æ­·è³‡æ–™'
        document.querySelector('h2').textContent = 'å¡«å¯«ç—…æ­·è³‡æ–™'
        document.querySelector('label[for="date"]').textContent = 'æ—¥æœŸ';
        document.querySelector('label[for="q1"]').textContent = 'è«‹å•æœ‰ç„¡é‡å¤§ç—…å²ï¼Ÿ';
        document.querySelector('label[for="q2"]').textContent = 'ç›®å‰æœ‰å“ªäº›ä¸é©çš„æƒ…æ³ï¼Ÿ';
        document.querySelector('label[for="q3"]').textContent = 'ç”Ÿæ´»ç¿’æ…£';
        document.querySelector('label[for="q4"]').textContent = 'ç›®å‰æ˜¯å¦æœ‰åœ¨æœç”¨ä»»ä½•è—¥ç‰©æˆ–å…¶ä»–æ²»ç™‚';
        document.querySelector('label[for="q5"]').textContent = 'æ˜¯å¦æœ‰ç¶“é†«å¸«è¨ºæ–·çš„çµæœ';
        document.querySelector('label[for="q6"]').textContent = 'å…¶ä»–å¥åº·ç–‘æ…®';
        document.querySelector('label[for="q7"]').textContent = 'å¹´é½¡';
        document.querySelector('label[for="thisname"]').textContent = 'åç¨±' 
        document.querySelector('#submitbtn').textContent = 'æäº¤'
      }
    }
  
    document.addEventListener('DOMContentLoaded',updateenterLangUI);
</script>
</body>
</html>
