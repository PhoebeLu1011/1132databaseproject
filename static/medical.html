<!DOCTYPE html>
<html> 
<head>
  <meta charset="UTF-8">
  <title>Medical Records</title>
  <style>
    body {
      background-color: #fef3e2;
      font-family: Arial, sans-serif;
      padding: 20px;
    }

    .back-button {
      display: inline-block;
      font-size: 20px;
      font-weight: bold;
      background-color: white;
      color: #333;
      border-radius: 50%;
      padding: 6px 12px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      margin-bottom: 20px;
    }

    h1 {
      margin: 0;
    }

    .subtitle {
      color: gray;
      margin-bottom: 30px;
    }

    .record {
      margin-bottom: 30px;
      background-color: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .record h2 {
      font-size: 18px;
      margin: 0 0 10px 0;
    }

    .record p {
      margin: 0 0 10px 0;
    }

    .record button {
      padding: 6px 12px;
      background-color: white;
      border: 1px solid gray;
      border-radius: 6px;
      cursor: pointer;
    }

    .record button:hover {
      background-color: #ddd;
    }
  </style>
  <script src="lang.js"></script>
</head>
<body>
  <div class="back-button" onclick="window.location.href='main.html'">üè†</div>
  
  <div class="back-button" onclick="history.back()">‚Üê</div>

  <h1 id="pageTitle">Medical Records</h1>
  <p class="subtitle" id="pageSubtitle">Your health story, organized for you.</p>

<div id="recordContainer"></div>

<script>
    const currentLang = navigator.language.startsWith("zh") ? "zh-TW" : "en";
    document.addEventListener('DOMContentLoaded', () => {
    const records = JSON.parse(localStorage.getItem("medicalRecords") || "[]");
    const container = document.getElementById("recordContainer");
    records.sort((a, b) => new Date(b.date) - new Date(a.date));
    if (records.length === 0) {
      container.innerHTML = '<p id="noRecordMsg">No records found.</p>';
    } 
    else {
      records.forEach((rec, index) => {
        const card = document.createElement("div");
        card.className = "record";
        card.innerHTML = `
          <h2>${rec.date}</h2>
          <p>${rec.summary || rec.thisname || "Summary is being generated..."}</p>
          <button class="btn-seemore" onclick="viewDetail('${rec.date}')">See More</button>
          <button class="btn-askai" onclick="askAI('${rec.date}')">Get AI Suggestions</button>
          <button class="btn-delete" onclick="deleteRecord('${rec.date}')">üóë Delete</button>
        `;
        container.appendChild(card);
      });
    }
    updateMedicalLangUI();
  })
    function viewDetail(date) {
      localStorage.setItem("selectedRecord", date);
      window.location.href = "medical-detail.html";
    }
    function askAI(date) {
      const records = JSON.parse(localStorage.getItem("medicalRecords") || "[]");
      const selected = records.find(r => r.date === date);
      const wellnessData = JSON.parse(localStorage.getItem("wellnessData") || "[]");

      if (wellnessData.length >= 20) {
        let alertMes = "‚ö†Ô∏èYou've reached the maximum. Please keep fewer than 20 entries in the wellness dashboard.";
        
        if (currentLang === "zh-TW") {
          alertMes = "‚ö†Ô∏èÂ∑≤ÈÅî‰∏äÈôêÔºåË´ãÂÖàÂà™Ê∏õÂÑÄË°®ÊùøË£°ÁöÑË≥áÊñôËá≥ 20 Á≠Ü‰ª•‰∏ã";
        }
        alert(alertMes);
      return;
    }

      const alreadyExists = wellnessData.some(item => item.date === selected.date);
      if (alreadyExists) {
         let alertMess = `‚ö†Ô∏èAI feedback for ${selected.date} already exists. Delete before resubmitting.`;
        if (currentLang === "zh-TW") {
          alertMess = `‚ö†Ô∏è ${selected.date} ÁöÑ AI ÂõûË¶ÜÂ∑≤Á∂ìÂ≠òÂú®ÂõâÔºÅË´ãÂÖàÂà™Èô§ÂÜçÈáçÊñ∞ÈÄÅÂá∫„ÄÇ`;
        }
        alert(alertMess);
        return;
      }
      const loadedFlag = `wellnessLoaded-${selected.date}`;
      sessionStorage.setItem("selectedRecord", JSON.stringify(selected));
      window.location.href = "loading.html";
    }
    function deleteRecord(date) {
      let confirmMsg = "Are you sure you want to delete this record?";
      if (currentLang === "zh-TW") {
        confirmMsg = "Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜÁ¥ÄÈåÑÂóéÔºü";
      }

      if (!confirm(confirmMsg)) return;
      
        const records = JSON.parse(localStorage.getItem("medicalRecords") || "[]");
        const updated = records.filter(r => r.date !== date); // ‚úÖ ‰øùÁïôÂÖ∂‰ªñË≥áÊñô
        localStorage.setItem("medicalRecords", JSON.stringify(updated));
        location.reload();
}


    function updateMedicalLangUI() {
      const msg = document.getElementById('noRecordMsg');
      if (msg) msg.textContent = 'Â∞öÁÑ°Á¥ÄÈåÑ';
      if (currentLang === 'zh-TW') {
        document.getElementById('pageTitle').textContent = 'ÂÅ•Â∫∑Á¥ÄÈåÑ';
        document.getElementById('pageSubtitle').textContent = 'ÁÇ∫‰Ω†Êï¥ÁêÜÁöÑÂÅ•Â∫∑Ê≠∑Á®ã';

        document.querySelectorAll('.btn-seemore').forEach(btn => {
          btn.textContent = 'Êü•ÁúãÊõ¥Â§ö';
        });
        document.querySelectorAll('.btn-askai').forEach(btn => {
          btn.textContent = 'ÂèñÂæó AI Âª∫Ë≠∞';
        });
        document.querySelectorAll('.btn-delete').forEach(btn => {
          btn.textContent = 'üóë Âà™Èô§';
        });
    }
    }

</script>
</body>
</html>